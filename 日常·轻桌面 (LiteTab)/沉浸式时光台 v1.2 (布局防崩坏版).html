<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ²‰æµ¸å¼æ—¶å…‰å°</title>
    <!-- å¼•å…¥ Lunar å†œå†åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.2.37/lunar.min.js"></script>
    <style>
        /* ================= å˜é‡å®šä¹‰ ================= */
        :root {
            --bg-gradient: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.6);
            --text-main: #2c3e50;
            --text-sec: #596b7e;
            --accent: #6c5ce7;
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --btn-bg: rgba(255, 255, 255, 0.6);
            --holiday-color: #ff4757; 
            --lunar-color: #888;
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            --glass-bg: rgba(30, 30, 30, 0.75);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ecf0f1;
            --text-sec: #bdc3c7;
            --accent: #00b894;
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            --btn-bg: rgba(255, 255, 255, 0.1);
            --holiday-color: #ff6b81;
            --lunar-color: #aaa;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg-gradient);
            background-size: 200% 200%;
            animation: gradientMove 15s ease infinite;
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: color 0.3s;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ä¸»å®¹å™¨ */
        .container {
            width: 100%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 1.3fr 0.7fr; 
            gap: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            padding: 25px;
            backdrop-filter: blur(4px);
        }

        /* å¡ç‰‡é€šç”¨ */
        .card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 25px;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .card:hover { transform: translateY(-3px); }

        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        h2 { font-size: 1.1rem; color: var(--text-sec); text-transform: uppercase; letter-spacing: 1px; }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .app-title { font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px; }
        .theme-switch {
            background: var(--btn-bg); border: 1px solid var(--glass-border); color: var(--text-main);
            padding: 8px 16px; border-radius: 50px; cursor: pointer; font-weight: 600;
        }

        /* ================= å·¦ä¾§ï¼šæ—¶é’Ÿ+æ—¥å† ================= */
        .time-cal-section {
            justify-content: flex-start; 
            gap: 20px; /* ç´§å‡‘é—´è· */
            height: 100%;
        }

        /* æ—¶é’ŸåŒºåŸŸ */
        .clock-header { text-align: center; padding-bottom: 5px; }
        .time-big {
            font-size: 4rem; font-weight: 700; line-height: 1;
            background: linear-gradient(to right, var(--text-main), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 5px; font-variant-numeric: tabular-nums;
        }
        .date-full { font-size: 1.1rem; color: var(--text-sec); }
        .nongli-info { font-size: 0.95rem; color: var(--accent); font-weight: 500; margin-top: 5px; }

        /* æ—¥å†åŒºåŸŸ */
        .calendar-controls {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; font-weight: bold; font-size: 1.1rem;
        }
        .cal-btn {
            background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--text-main);
            padding: 5px 12px; border-radius: 8px; transition: 0.2s;
        }
        .cal-btn:hover { background: var(--btn-bg); color: var(--accent); }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            text-align: center;
            /* å¼ºåˆ¶æ¯ä¸€åˆ—å®½åº¦å›ºå®šï¼Œé˜²æ­¢è¢«æ–‡å­—æ’‘å¼€ */
            table-layout: fixed; 
        }
        .day-label { font-size: 0.85rem; color: var(--text-sec); font-weight: 600; padding-bottom: 8px; }
        
        /* æ—¥æœŸæ ¼å­ */
        .day-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: default;
            transition: all 0.2s;
            overflow: hidden; /* å…³é”®ï¼šé˜²æ­¢å†…å®¹æº¢å‡º */
            padding: 2px;
            position: relative;
        }
        .day-cell:hover:not(.empty) { background: var(--btn-bg); }
        
        .gregorian { font-size: 1.1rem; font-weight: 600; line-height: 1.2; }
        
        /* å…³é”®ä¿®æ”¹ï¼šå†œå†/èŠ‚æ—¥æ–‡å­—é™åˆ¶ */
        .lunar {
            font-size: 0.65rem; /* ç¨å¾®è°ƒå°å­—ä½“ */
            color: var(--lunar-color);
            line-height: 1.2;
            margin-top: 2px;
            
            /* å¼ºåˆ¶å•è¡Œ + çœç•¥å· */
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%; /* é™åˆ¶å®½åº¦ä¸ºçˆ¶å®¹å™¨å®½åº¦ */
            padding: 0 4px; /* å·¦å³ç•™ç‚¹ç¼éš™ */
        }
        
        .day-cell.today { background: var(--accent); color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .day-cell.today .lunar { color: rgba(255,255,255,0.8); }

        .day-cell.holiday .lunar { color: var(--holiday-color); font-weight: bold; }
        .day-cell.today.holiday .lunar { color: #ffcccc; }

        /* ================= å³ä¾§ï¼šå·¥å…·åŒº ================= */
        .tools-col { display: flex; flex-direction: column; gap: 20px; }

        .calc-screen {
            width: 100%; height: 50px; background: rgba(0,0,0,0.03);
            border: none; border-radius: 10px; margin-bottom: 10px;
            text-align: right; padding: 10px; font-size: 1.5rem;
            color: var(--text-main); font-family: 'Courier New', monospace;
        }
        .calc-pad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .c-btn {
            padding: 12px; border: none; border-radius: 10px; font-size: 1rem;
            cursor: pointer; background: var(--btn-bg); color: var(--text-main); transition: 0.2s;
        }
        .c-btn:hover { background: var(--glass-border); transform: scale(1.05); }
        .c-btn.opt { color: var(--accent); font-weight: bold; }
        .c-btn.eq { background: var(--accent); color: white; grid-column: span 2; }

        .notepad-container { flex-grow: 1; min-height: 200px; }
        .note-area {
            width: 100%; flex-grow: 1; background: transparent; border: none;
            resize: none; color: var(--text-main); font-size: 0.95rem; line-height: 1.6;
            background-image: linear-gradient(transparent 95%, var(--glass-border) 95%);
            background-size: 100% 1.6rem;
        }
        .note-status { font-size: 0.75rem; color: var(--accent); text-align: right; opacity: 0; transition: opacity 0.5s; }
        .note-status.show { opacity: 1; }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; padding: 15px; gap: 15px; }
            .time-big { font-size: 3rem; }
            .time-cal-section { gap: 20px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- é¡¶éƒ¨ -->
        <div class="top-bar">
            <div class="app-title">â³ æ²‰æµ¸å¼æ—¶å…‰å°</div>
            <button class="theme-switch" onclick="toggleTheme()">
                <span id="themeIcon">ğŸŒ™</span> æ¨¡å¼
            </button>
        </div>

        <!-- å·¦ä¾§ï¼šæ—¶é—´ + å†œå†æ—¥å† -->
        <div class="card time-cal-section">
            <!-- å¤´éƒ¨ï¼šå¤§æ—¶é’Ÿ -->
            <div class="clock-header">
                <div class="time-big" id="clockTime">00:00:00</div>
                <div class="date-full">
                    <span id="clockDate">åŠ è½½ä¸­...</span>
                </div>
                <!-- å†œå†å¤§å­—æ˜¾ç¤º -->
                <div class="nongli-info" id="nongliBig">æ­£åœ¨è®¡ç®—å†œå†...</div>
            </div>

            <!-- åº•éƒ¨ï¼šæ—¥å†ç½‘æ ¼ -->
            <div class="calendar-wrapper">
                <div class="calendar-controls">
                    <button class="cal-btn" onclick="changeMonth(-1)">&#10094;</button>
                    <span id="calTitle">2023å¹´ 10æœˆ</span>
                    <button class="cal-btn" onclick="changeMonth(1)">&#10095;</button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šå·¥å…·æ  -->
        <div class="tools-col">
            <!-- è®¡ç®—å™¨ -->
            <div class="card">
                <div class="header-row"><h2>ğŸ§® å¿«æ·è®¡ç®—</h2></div>
                <input type="text" class="calc-screen" id="calcScreen" readonly>
                <div class="calc-pad">
                    <button class="c-btn" style="color:#ff4757" onclick="clearCalc()">C</button>
                    <button class="c-btn" onclick="backspace()">â†</button>
                    <button class="c-btn opt" onclick="insert('/')">Ã·</button>
                    <button class="c-btn opt" onclick="insert('*')">Ã—</button>
                    <button class="c-btn" onclick="insert('7')">7</button>
                    <button class="c-btn" onclick="insert('8')">8</button>
                    <button class="c-btn" onclick="insert('9')">9</button>
                    <button class="c-btn opt" onclick="insert('-')">-</button>
                    <button class="c-btn" onclick="insert('4')">4</button>
                    <button class="c-btn" onclick="insert('5')">5</button>
                    <button class="c-btn" onclick="insert('6')">6</button>
                    <button class="c-btn opt" onclick="insert('+')">+</button>
                    <button class="c-btn" onclick="insert('1')">1</button>
                    <button class="c-btn" onclick="insert('2')">2</button>
                    <button class="c-btn" onclick="insert('3')">3</button>
                    <button class="c-btn eq" onclick="calc()">=</button>
                    <button class="c-btn" onclick="insert('0')" style="grid-column: span 2">0</button>
                    <button class="c-btn" onclick="insert('.')">.</button>
                </div>
            </div>

            <!-- è®°äº‹æœ¬ -->
            <div class="card notepad-container">
                <div class="header-row"><h2>ğŸ“ å¤‡å¿˜å½•</h2></div>
                <textarea id="myNote" class="note-area" placeholder="åœ¨æ­¤è®°å½•ä»Šæ—¥æƒ³æ³•..."></textarea>
                <div id="saveTip" class="note-status">å·²è‡ªåŠ¨ä¿å­˜</div>
            </div>
        </div>
    </div>

    <script>
        // ================= 1. ä¸»é¢˜åˆ‡æ¢ =================
        const body = document.body;
        const icon = document.getElementById('themeIcon');
        const savedTheme = localStorage.getItem('theme') || 'light';
        
        function applyTheme(theme) {
            body.setAttribute('data-theme', theme);
            icon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('theme', theme);
        }
        function toggleTheme() {
            const current = body.getAttribute('data-theme');
            applyTheme(current === 'dark' ? 'light' : 'dark');
        }
        applyTheme(savedTheme);

        // ================= 2. æ—¶é’Ÿä¸å®æ—¶å†œå† =================
        function updateClock() {
            const now = new Date();
            document.getElementById('clockTime').textContent = now.toLocaleTimeString('zh-CN', {hour12: false});
            
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('clockDate').textContent = now.toLocaleDateString('zh-CN', options);
            
            try {
                // ä½¿ç”¨ Lunar åº“è·å–å†œå†ä¿¡æ¯
                const lunar = Lunar.fromDate(now);
                const holiday = getHolidayText(lunar);
                const jieQi = lunar.getJieQi();
                let extra = holiday ? ` Â· ${holiday}` : (jieQi ? ` Â· ${jieQi}` : '');
                
                document.getElementById('nongliBig').textContent = 
                    `${lunar.getYearInGanZhi()}å¹´ ${lunar.getMonthInChinese()}æœˆ${lunar.getDayInChinese()}${extra}`;
            } catch (e) {
                document.getElementById('nongliBig').textContent = "åŠ è½½å†œå†ä¸­...";
            }
        }
        setInterval(updateClock, 1000);

        // ================= 3. æ—¥å†é€»è¾‘ (å«é•¿æ–‡æœ¬é˜²æº¢å‡ºå¤„ç†) =================
        let calDate = new Date();

        // è¾…åŠ©å‡½æ•°ï¼šè·å–èŠ‚æ—¥æ–‡å­—
        function getHolidayText(lunarObj) {
            // 1. å†œå†èŠ‚æ—¥
            const festivals = lunarObj.getFestivals();
            if (festivals.length > 0) return festivals[0];
            
            // 2. 24èŠ‚æ°”
            const jieQi = lunarObj.getJieQi();
            if (jieQi) return jieQi;

            // 3. å…¬å†èŠ‚æ—¥
            const solar = lunarObj.getSolar();
            const solarFestivals = solar.getFestivals();
            if (solarFestivals.length > 0) return solarFestivals[0];

            return null;
        }

        function renderCalendar() {
            const year = calDate.getFullYear();
            const month = calDate.getMonth();
            const today = new Date();

            document.getElementById('calTitle').textContent = `${year}å¹´ ${month + 1}æœˆ`;

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // æ˜ŸæœŸå¤´
            ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(d => {
                const el = document.createElement('div');
                el.className = 'day-label';
                el.textContent = d;
                grid.appendChild(el);
            });

            // è®¡ç®—æ’ç‰ˆ
            const firstDay = new Date(year, month, 1).getDay();
            const daysTotal = new Date(year, month + 1, 0).getDate();

            // å¡«å……ç©ºç™½
            for(let i=0; i<firstDay; i++) {
                const el = document.createElement('div');
                el.className = 'day-cell empty';
                grid.appendChild(el);
            }

            // å¡«å……æ—¥æœŸ
            for(let i=1; i<=daysTotal; i++) {
                const el = document.createElement('div');
                el.className = 'day-cell';
                
                const currentD = new Date(year, month, i);
                
                // å…¬å†æ•°å­—
                const gSpan = document.createElement('span');
                gSpan.className = 'gregorian';
                gSpan.textContent = i;
                
                // å†œå†/èŠ‚æ—¥æ–‡å­—
                const lSpan = document.createElement('span');
                lSpan.className = 'lunar';
                
                try {
                    const lunar = Lunar.fromDate(currentD);
                    const text = getHolidayText(lunar);
                    
                    if (text) {
                        lSpan.textContent = text;
                        el.classList.add('holiday'); 
                        // å…³é”®ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºå®Œæ•´èŠ‚æ—¥åç§°
                        el.title = text; 
                    } else {
                        const dayChinese = lunar.getDayInChinese();
                        const monthChinese = lunar.getMonthInChinese() + 'æœˆ';
                        // åˆä¸€æ˜¾ç¤ºæœˆä»½
                        lSpan.textContent = lunar.getDay() === 1 ? monthChinese : dayChinese;
                        el.title = `${lunar.getMonthInChinese()}æœˆ${lunar.getDayInChinese()}`;
                    }
                } catch(e) {
                    lSpan.textContent = '-';
                }

                el.appendChild(gSpan);
                el.appendChild(lSpan);

                // æ ‡è®°ä»Šå¤©
                if(i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    el.classList.add('today');
                }
                
                grid.appendChild(el);
            }
        }

        function changeMonth(step) {
            calDate.setMonth(calDate.getMonth() + step);
            renderCalendar();
        }

        // ================= 4. å·¥å…·åŠŸèƒ½ =================
        const screen = document.getElementById('calcScreen');
        function insert(char) { screen.value += char; }
        function clearCalc() { screen.value = ''; }
        function backspace() { screen.value = screen.value.slice(0, -1); }
        function calc() {
            try { if(screen.value) screen.value = eval(screen.value); } 
            catch { screen.value = 'Error'; setTimeout(() => screen.value = '', 800); }
        }

        const note = document.getElementById('myNote');
        const tip = document.getElementById('saveTip');
        let timeout;
        note.value = localStorage.getItem('lumi_note') || '';
        note.addEventListener('input', () => {
            localStorage.setItem('lumi_note', note.value);
            tip.classList.add('show');
            clearTimeout(timeout);
            timeout = setTimeout(() => tip.classList.remove('show'), 1500);
        });

        // å¯åŠ¨
        window.onload = function() {
            updateClock();
            renderCalendar();
        };

    </script>
</body>
</html>